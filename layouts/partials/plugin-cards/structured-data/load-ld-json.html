{{- /*
  Loads the JSON object into the provided scratch.
  */ -}}
{{- $scratch := .scratch -}}
{{- $context := .context -}}

{{- /* 
  Insert the context and type.
  */ -}}
{{- $scratch.SetInMap "StructuredData.JSON" "@context" "https://schema.org" -}}
{{- $scratch.SetInMap "StructuredData.JSON" "@type" "BlogPosting" -}}

{{- /* 
  When an author name is available, generate a map for the
  author with the name and, optionally, the URL.
  */ -}}
{{- with ($scratch.Get "StructuredData").Parameters.AuthorName -}}
{{- $scratch.SetInMap "StructuredData.Author" "@type" "Person" -}}
{{- $scratch.SetInMap "StructuredData.Author" "name" . -}}
{{- with ($scratch.Get "StructuredData").Parameters.ProfileURL -}}
{{- $scratch.SetInMap "StructuredData.Author" "url" . -}}
{{- end -}}
{{- end -}}
{{- with $scratch.Get "StructuredData.Author" -}}
{{- $scratch.SetInMap "StructuredData.JSON" "author" . -}}
{{- $scratch.Delete "StructuredData.Author" -}}
{{- end -}}

{{- /* 
  Process the .Date page variable. Ideally we would want
  to utilize the .Lastmod and .PublishDate page variables;
  however, these values are not currently set in the page
  front matter so they resolve to the value of .Date.
  */ -}}
{{- if (not $context.Date.IsZero) -}}
{{- $date := $context.Date.Format "2006-01-02T15:04:05-07:00" -}}
{{- $scratch.SetInMap "StructuredData.JSON" "datePublished" $date -}}
{{- end -}}

{{- /* 
  Insert the post title as the headline.
  */ -}}
{{- with $context.Title -}}
{{- $scratch.SetInMap "StructuredData.JSON" "headline" . -}}
{{- end -}}

{{- /* 
  Insert any images found in the page front matter. 
  */ -}}
{{- with $context.Params.images -}}
{{- $scratch.SetInMap "StructuredData.JSON" "image" (apply . "absURL" ".") -}}
{{- end -}}

{{- /* 
  Insert the page summary for a description.
  */ -}}
{{- with $context.Summary -}}
{{- $scratch.SetInMap "StructuredData.JSON" "description" (. | plainify | chomp) -}}
{{- end -}}

{{- /* 
  Insert the page's word count.
  */ -}}
{{- with $context.WordCount -}}
{{- $scratch.SetInMap "StructuredData.JSON" "wordcount" . -}}
{{- end -}}

{{- /* Move the constructed JSON object under StructuredData. */ -}}
{{- $JSON := $scratch.Get "StructuredData.JSON" -}}
{{- $scratch.Delete "StructuredData.JSON" -}}
{{- $scratch.SetInMap "StructuredData" "JSON" $JSON -}}